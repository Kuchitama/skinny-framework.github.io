<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Controller & Routes - Skinny Framework</title>
    <script type="text/javascript" src="//codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css"/>
    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
    <div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Skinny Framework</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="/documentation" class="dropdown-toggle" data-toggle="dropdown">Documentation&nbsp;<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documentation/getting-started.html">Getting Started</a></li>
                <li><a href="/documentation/controller-and-routes.html">Controller & Routes</a></li>
                <li><a href="/documentation/validator.html">Validator</a></li>
                <li><a href="/documentation/view-templates.html">View Templates</a></li>
                <li><a href="/documentation/assets.html">Assets Support</a></li>
                <li><a href="/documentation/mail.html">Mail</a></li>
                <li><a href="/documentation/orm.html">O/R Mapper</a></li>
                <li><a href="/documentation/factory-girl.html">FactoryGirl</a></li>
                <li><a href="/documentation/db-migration.html">DB Migration</a></li>
                <li><a href="/documentation/json.html">Working with JSON</a></li>
                <li><a href="/documentation/tasks.html">Tasks</a></li>
                <li><a href="/documentation/testing.html">Testing</a></li>
                <li><a href="/documentation/packaging.html">Packaging</a></li>
                <li><a href="/contribution.html">Contribution</a></li>
              </ul>
            </li>
            <li><a href="https://groups.google.com/forum/#!forum/skinny-framework">Users Group</a></li>
            <li><a href="https://github.com/skinny-framework/skinny-framework">GitHub</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
        <div class="col-xs-2">
          <div class="content small">
            <h5>Documentation</h5>
            <hr/>
            <p><a href="/documentation/getting-started.html">Getting Started</a></p>
            <p><a href="/documentation/controller-and-routes.html">Controller & Routes</a></p>
            <p><a href="/documentation/validator.html">Validator</a></p>
            <p><a href="/documentation/view-templates.html">View Templates</a></p>
            <p><a href="/documentation/assets.html">Assets Support</a></p>
            <p><a href="/documentation/mail.html">Mail</a></p>
            <p><a href="/documentation/orm.html">O/R Mapper</a></p>
            <p><a href="/documentation/factory-girl.html">FactoryGirl</a></p>
            <p><a href="/documentation/db-migration.html">DB Migration</a></p>
            <p><a href="/documentation/json.html">Working with JSON</a></p>
            <p><a href="/documentation/tasks.html">Tasks</a></p>
            <p><a href="/documentation/testing.html">Testing</a></p>
            <p><a href="/documentation/packaging.html">Packaging</a></p>
            <p><a href="/contribution.html">Contribution</a></p>
          </div>
        </div>
        <div class="col-xs-10">
          <div class="content">
<a href="https://github.com/skinny-framework/skinny-framework"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
            <h2 id="toc_0">Controller &amp; Routes</h2>

<hr/>

<p>Skinny&rsquo;s routing mechanism and controller layer on MVC architecture is a <strong>rich Scalatra</strong>. </p>

<p>Skinny&rsquo;s extension provides you much simpler/rich syntax. Of course, if you need to use Scalatra&rsquo;s API directly, Skinny never bothers you.</p>

<p><img alt="Scalatra" src="/images/scalatra.png" /></p>

<p><code>SkinnyController</code> is a trait which extends <code>ScalatraFilter</code> and out-of-the-box components are integrated.</p>
<pre class="highlight java"><span class="c1">// src/main/scala/controller/MembersController.scala</span>
<span class="kd">class</span> <span class="nc">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection enabled</span>

  <span class="n">def</span> <span class="n">index</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// set &#39;members&#39; in the request scope, then you can use it in views</span>
    <span class="n">set</span><span class="o">(</span><span class="s">&quot;members&quot;</span> <span class="o">-&gt;</span> <span class="n">Member</span><span class="o">.</span><span class="na">findAll</span><span class="o">())</span>
    <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/index&quot;</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="n">def</span> <span class="n">newOne</span> <span class="o">=</span> <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)</span>

  <span class="n">def</span> <span class="n">createForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">params</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">minLength</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;countryId&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">numeric</span>
  <span class="o">)</span>

  <span class="n">def</span> <span class="n">createFormParams</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">permit</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> 
    <span class="s">&quot;countryId&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">Long</span><span class="o">)</span>

  <span class="n">def</span> <span class="n">create</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">createForm</span><span class="o">.</span><span class="na">validate</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">Member</span><span class="o">.</span><span class="na">createWithPermittedAttributes</span><span class="o">(</span><span class="n">createFormParams</span><span class="o">)</span>
    <span class="n">redirect</span><span class="o">(</span><span class="s">&quot;/members&quot;</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">render</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">// whether query param or path param</span>
  <span class="n">def</span> <span class="n">show</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getAs</span><span class="o">[</span><span class="n">Long</span><span class="o">](</span><span class="s">&quot;id&quot;</span><span class="o">).</span><span class="na">map</span> <span class="o">{</span> <span class="n">id</span> <span class="o">=&gt;</span>
    <span class="n">Member</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">map</span> <span class="o">{</span> <span class="n">member</span> <span class="o">=&gt;</span>
      <span class="n">set</span><span class="o">(</span><span class="s">&quot;member&quot;</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">)</span>
    <span class="o">}.</span><span class="na">getOrElse</span> <span class="n">haltWithBody</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">getOrElse</span> <span class="n">haltWithBody</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>

<span class="o">}</span>

<span class="c1">// src/main/scala/controller/Controllers.scala</span>
<span class="n">object</span> <span class="n">Controllers</span> <span class="o">{</span>
  <span class="n">object</span> <span class="n">members</span> <span class="kd">extends</span> <span class="n">MembersController</span> <span class="n">with</span> <span class="n">Routes</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">indexUrl</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">index</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">newUrl</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)(</span><span class="n">newOne</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="k">new</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">createUrl</span> <span class="o">=</span> <span class="n">post</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">create</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">create</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">showUrl</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/:id&quot;</span><span class="o">)(</span><span class="n">show</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">show</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// src/main/scala/ScalatraBootstrap.scala</span>
<span class="kd">class</span> <span class="nc">ScalatraBootstrap</span> <span class="n">exntends</span> <span class="n">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="nl">ctx:</span> <span class="n">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// register routes</span>
    <span class="n">Controllers</span><span class="o">.</span><span class="na">members</span><span class="o">.</span><span class="na">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p><code>#render</code> expects <code>src/main/webapp/WEB-INF/views/members/index.html.ssp</code> by default.</p>
<pre class="highlight text">render(&quot;/members/index&quot;)
</pre><pre class="highlight text">&lt;!-- src/main/webapp/WEB-INF/views/members/index.html.ssp --&gt;
&lt;%@val members: Seq[Member]%&gt;
&lt;ul&gt;
#for (member &lt;- members)
  &lt;li&gt;${member.name}&lt;/li&gt;
#end
&lt;ul&gt;
</pre>
<hr/>

<h3 id="toc_1">Reverse Routes</h3>

<hr/>

<p>You can use Scalatra&rsquo;s reverse routes.</p>

<p><a href="http://www.scalatra.org/2.2/guides/http/reverse-routes.html">http://www.scalatra.org/2.2/guides/http/reverse-routes.html</a></p>

<p>In controllers:</p>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="o">{</span>
  <span class="n">def</span> <span class="n">oldPage</span> <span class="o">=</span> <span class="n">redirect</span><span class="o">(</span><span class="n">url</span><span class="o">(</span><span class="n">Controllers</span><span class="o">.</span><span class="na">members</span><span class="o">.</span><span class="na">indexUrl</span><span class="o">))</span>
<span class="o">}</span>

<span class="n">object</span> <span class="n">Controllers</span> <span class="o">{</span>
  <span class="n">object</span> <span class="n">members</span> <span class="kd">extends</span> <span class="n">MembersController</span> <span class="n">with</span> <span class="n">Routes</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">indexUrl</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">index</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">showUrl</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/:id&quot;</span><span class="o">)(</span><span class="n">show</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">show</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>In views:</p>
<pre class="highlight text">// Jade example
a(href={url(Controllers.members.showUrl, &quot;id&quot; -&gt; member.id.toString)}) Show detail

</pre>
<p>FYI: You can see more examples for SkinnyResource by generating scaffold views.</p>

<hr/>

<h3 id="toc_2">SkinnyController &amp; SkinnyServlet</h3>

<hr/>

<p>There are two controller base trait. SkinnyController is a ScalatraFilter. SkinnyServlet is a ScalatraServlet.</p>

<ul>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraFilter)">org.scalatra.ScalatraFilter</a></li>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraServlet)">org.scalatra.ScalatraServlet</a></li>
</ul>

<p>Basically SkinnyController is more suitable for Skinny framework based applications.</p>

<p>However, really you need to use ScalatraServlet, use SkinnyServlet instead.</p>

<hr/>

<h3 id="toc_3">SkinnyResource</h3>

<hr/>

<p>SkinnyResource is a useful base trait for RESTful web services. SkinnyResource is very similar to Rails ActiveResource.</p>

<p><a href="http://guides.rubyonrails.org/routing.html#resource-routing-the-rails-default">Resource Routing: the Rails Default (Rails Routing from the Outside In — Ruby on Rails Guides)</a></p>

<p><a href="https://github.com/rails/activeresource">https://github.com/rails/activeresource</a></p>

<p>SkinnyResource is also useful as a controller sample. If you&rsquo;re a Skinny beginner, take a look at its code.</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>

<p>SkinnyResourceActions has action methods for the resource and SkinnyResourceRoutes defines routings for the resource.
If you&rsquo;d like to customize routings (e.g. use only creation and deletion), just mixin only SkinnyResourceActions and define routings by yourself.</p>

<p>You can get SkinnyResource example by scaffolding.</p>
<pre class="highlight text">./skinny g scaffold members member name:String birthday:LocalDate
</pre>
<p>Then you get the following code. If you need to customize, override some parts of SkinnyResource:</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>
<pre class="highlight java"><span class="kn">package</span> <span class="n">controller</span>

<span class="kn">import</span> <span class="nn">skinny._</span>
<span class="kn">import</span> <span class="nn">skinny.validator._</span>
<span class="kn">import</span> <span class="nn">model.Member</span>

<span class="n">object</span> <span class="n">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyResource</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection</span>

  <span class="n">override</span> <span class="n">def</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Member</span> <span class="c1">// SkinnyModel for this controller</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">resourcesName</span> <span class="o">=</span> <span class="s">&quot;members&quot;</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">resourceName</span> <span class="o">=</span> <span class="s">&quot;member&quot;</span>

  <span class="c1">// parameters &amp; validations for creation</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">createParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createParams</span> <span class="o">=</span> <span class="n">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">withDate</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">createFormStrongParameters</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span>
    <span class="s">&quot;birthday&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">LocalDate</span>
  <span class="o">)</span>

  <span class="c1">// parameters &amp; validations for modification</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateForm</span> <span class="o">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">updateParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateParams</span> <span class="o">=</span> <span class="n">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">withDate</span><span class="o">(</span><span class="s">&quot;birthday&quot;</span><span class="o">)</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">updateFormStrongParameters</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span>
    <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">String</span><span class="o">,</span>
    <span class="s">&quot;birthday&quot;</span> <span class="o">-&gt;</span> <span class="n">ParamType</span><span class="o">.</span><span class="na">LocalDate</span>
  <span class="o">)</span>

<span class="o">}</span>
</pre>
<p>Required view templates:</p>
<pre class="highlight text">src/main/webapp/WEB-INF/views/members/
├── _form.html.ssp
├── edit.html.ssp
├── index.html.ssp
├── new.html.ssp
└── show.html.ssp
</pre>
<p>In this case, SkinnyResource provides the following URLs by default.</p>

<ul>
<li>GET /members</li>
<li>GET /members/</li>
<li>GET /members.xml</li>
<li>GET /members.json</li>
<li>GET /members/new</li>
<li>POST /members</li>
<li>POST /members/</li>
<li>GET /members/{id}</li>
<li>GET /members/{id}.xml</li>
<li>GET /members/{id}.json</li>
<li>GET /members/{id}/edit</li>
<li>POST /members/{id}</li>
<li>PUT /members/{id}</li>
<li>PATCH /members/{id}</li>
<li>DELETE /members/{id}</li>
</ul>

<hr/>

<h3 id="toc_4">skinny.Skinny</h3>

<hr/>

<p>skinny.Skinny provides getters for basic elements in view templates.</p>
<pre class="highlight text">&lt;%@val s: skinny.Skinny %&gt;
</pre>
<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/Skinny.scala">framework/src/main/scala/skinny/Skinny.scala</a></p>

<ul>
<li>params: Params</li>
<li>multiParams: MultiParams</li>
<li>flash: Flash</li>
<li>errorMessages: Seq[String]</li>
<li>keyAndErrorMessages: Map[String, Seq[String]]</li>
<li>contextPath: String</li>
<li>requestPath: String</li>
<li>requestPathWithQueryString: String</li>
<li>csrfKey: String</li>
<li>csrfToken: String</li>
<li>csrfMetaTag(s): String</li>
<li>csrfHiddenInputTag: String</li>
<li>i18n: I18n</li>
</ul>

<hr/>

<h3 id="toc_5">beforeAction/afterAction Filters</h3>

<hr/>

<p>Thoguh Scalatra has before/after filters by default. But we recommend Skinny users to use Skinny&rsquo;s beforeAction/afterAction filters.</p>

<p>The reason is that Scalatra&rsquo;s filters might effect other controllers that are defined below in ScalatraBootstrap.scala and it&rsquo;s not easy to figure out where each controller&rsquo;s before/after affects completely.</p>

<p>So if you need filters that are similar to Rails filters, just use Skinny filters.</p>

<h5 id="toc_6">Scalatra&rsquo;s before/after filters</h5>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<ul>
<li>before(transformers)(action)</li>
<li>after(transformers)(action)</li>
</ul>

<h5 id="toc_7">Skinny&rsquo;s beforeAction/afterAction filters</h5>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/master/framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala">/framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala</a></p>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">MembersController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="n">with</span> <span class="n">Routes</span> <span class="o">{</span>

  <span class="c1">// Scalatra filters</span>
  <span class="n">before</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span> <span class="c1">// might affect in other controllers</span>
  <span class="n">after</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

  <span class="c1">// Skinny filters</span>
  <span class="n">beforeAction</span><span class="o">(</span><span class="n">only</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span><span class="err">&#39;</span><span class="n">index</span><span class="o">,</span> <span class="err">&#39;</span><span class="k">new</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;before&quot;</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">afterAction</span><span class="o">(</span><span class="n">except</span> <span class="o">=</span> <span class="n">Seq</span><span class="o">(</span><span class="err">&#39;</span><span class="k">new</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;after&quot;</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">//actions</span>
  <span class="n">def</span> <span class="n">index</span> <span class="o">=</span> <span class="o">...</span>
  <span class="n">def</span> <span class="n">newInput</span> <span class="o">=</span> <span class="o">...</span>
  <span class="n">def</span> <span class="n">edit</span> <span class="o">=</span> <span class="o">...</span>

  <span class="c1">// routes</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/?&quot;</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">index</span><span class="o">)</span>      <span class="c1">// before, after</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/new&quot;</span><span class="o">)(</span><span class="n">newInput</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="k">new</span><span class="o">)</span>   <span class="c1">// before</span>
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/members/:id/edit&quot;</span><span class="o">)(</span><span class="n">edit</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="err">&#39;</span><span class="n">edit</span><span class="o">)</span> <span class="c1">// after</span>

<span class="o">}</span>
</pre>
<hr/>

<h3 id="toc_8">SkinnyFilter</h3>

<hr/>

<p>SkinnyFilter is our original filter to enable easily handling before/after/error for each controller. You can apply the same beforeAction/afterAction/error filters to several controllers by just mixing SkinnyFilter based traits.</p>

<p>Contrary to your expectations, Scalatra doesn&rsquo;t run all the handlers for after and error. Only the first one would be applied and the others are just ignored. We think it&rsquo;s difficult to be aware of this specification (it&rsquo;s not a bug but by design). So SkinnyFilter&rsquo;s before/after/error handlers would be always applied. </p>

<p>For instance, in skinny-blank-app, ErrrorPageFilter is applied to ApplicationController. </p>
<pre class="highlight java"><span class="n">trait</span> <span class="n">ApplicationController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span>
  <span class="n">with</span> <span class="n">ErrorPageFilter</span> <span class="o">{</span>

<span class="o">}</span>
</pre>
<p>ErrorPageFilter is as follows. It&rsquo;s pretty easy to customized such a filter (e.g. adding error notification). Isn&rsquo;t it?</p>
<pre class="highlight java"><span class="n">trait</span> <span class="n">ErrorPageFilter</span> <span class="kd">extends</span> <span class="n">SkinnyRenderingFilter</span> <span class="o">{</span>
  <span class="c1">// appends error filter in order</span>
  <span class="n">addRenderingErrorFilter</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nl">e:</span> <span class="n">Throwable</span> <span class="o">=&gt;</span>
      <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="n">render</span><span class="o">(</span><span class="s">&quot;/error/500&quot;</span><span class="o">)</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nl">e:</span> <span class="n">Exception</span> <span class="o">=&gt;</span> <span class="k">throw</span> <span class="n">e</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>It just outputs error logging, set status as 500 and renders &ldquo;/error/500.html.ssp&rdquo; or similar templates. <code>SkinnyRenderingFilter</code> is a sub trait of <code>SkinnyFilter</code>. <code>SkinnyFilter</code>&rsquo;s response value is always ignored. But <code>SkinnyRenderingFilter</code> can return response body like above.</p>

<p>Second example is <code>TxPerRequestFilter</code> which enables to apply open-session-in-view pattern to your apps.</p>
<pre class="highlight java"><span class="n">trait</span> <span class="n">TxPerRequestFilter</span> <span class="kd">extends</span> <span class="n">SkinnyFilter</span> <span class="n">with</span> <span class="n">Logging</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nl">cp:</span> <span class="n">ConnectionPool</span> <span class="o">=</span> <span class="n">ConnectionPool</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>

  <span class="n">def</span> <span class="n">begin</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">db</span> <span class="o">=</span> <span class="n">ThreadLocalDB</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cp</span><span class="o">.</span><span class="na">borrow</span><span class="o">())</span>
    <span class="n">db</span><span class="o">.</span><span class="na">begin</span><span class="o">()</span>
  <span class="o">}</span>

  <span class="n">addErrorFilter</span> <span class="o">{</span> <span class="k">case</span> <span class="nl">e:</span> <span class="n">Throwable</span> <span class="o">=&gt;</span>
    <span class="n">Option</span><span class="o">(</span><span class="n">ThreadLocalDB</span><span class="o">.</span><span class="na">load</span><span class="o">()).</span><span class="na">foreach</span> <span class="o">{</span> <span class="n">db</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">db</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">db</span><span class="o">.</span><span class="na">isTxNotActive</span><span class="o">)</span> <span class="n">using</span><span class="o">(</span><span class="n">db</span><span class="o">)(</span><span class="n">_</span><span class="o">.</span><span class="na">rollbackIfActive</span><span class="o">())</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">def</span> <span class="n">commit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">db</span> <span class="o">=</span> <span class="n">ThreadLocalDB</span><span class="o">.</span><span class="na">load</span><span class="o">()</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">db</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">db</span><span class="o">.</span><span class="na">isTxNotActive</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">using</span><span class="o">(</span><span class="n">db</span><span class="o">)(</span><span class="n">_</span><span class="o">.</span><span class="na">commit</span><span class="o">())</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">beforeAction</span><span class="o">()(</span><span class="n">begin</span><span class="o">)</span>
  <span class="n">afterAction</span><span class="o">()(</span><span class="n">commit</span><span class="o">)</span>
<span class="o">}</span>
</pre>
<hr/>

<h3 id="toc_9">How to Do It? Examples</h3>

<hr/>

<p>Basically, you will use Scalatra&rsquo;s DSL.</p>

<p><a href="http://www.scalatra.org/2.2/guides/">http://www.scalatra.org/2.2/guides/</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<hr/>

<h4 id="toc_10">(Query/Form/Path) Parameters</h4>

<hr/>

<h4 id="toc_11">params</h4>
<pre class="highlight java"><span class="n">val</span> <span class="nl">name:</span> <span class="n">Option</span><span class="o">[</span><span class="n">String</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
<span class="n">val</span> <span class="nl">id:</span> <span class="n">Option</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getAs</span><span class="o">[</span><span class="n">Int</span><span class="o">](</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
<span class="n">val</span> <span class="nl">id:</span> <span class="n">Long</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">getAsOrElse</span><span class="o">[</span><span class="n">Long</span><span class="o">](</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="o">-</span><span class="mi">1L</span><span class="o">)</span>

<span class="n">val</span> <span class="nl">ids:</span> <span class="n">Option</span><span class="o">[</span><span class="n">Seq</span><span class="o">[</span><span class="n">Int</span><span class="o">]]</span> <span class="o">=</span> <span class="n">multiParams</span><span class="o">.</span><span class="na">getAs</span><span class="o">[</span><span class="n">Int</span><span class="o">](</span><span class="s">&quot;ids&quot;</span><span class="o">)</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParams">/api/index.html#org.scalatra.ScalatraParams</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedParams">/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedParams</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedMultiParams">/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedMultiParams</a></p>

<hr/>

<h4 id="toc_12">multiParams(&ldquo;splat&rdquo;)</h4>
<pre class="highlight java"><span class="n">get</span><span class="o">(</span><span class="s">&quot;/say/*/to/*&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches &quot;GET /say/hello/to/world&quot;</span>
  <span class="n">multiParams</span><span class="o">(</span><span class="s">&quot;splat&quot;</span><span class="o">)</span> <span class="c1">// == Seq(&quot;hello&quot;, &quot;world&quot;)</span>
<span class="o">}</span>

<span class="n">get</span><span class="o">(</span><span class="s">&quot;/download/*.*&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches &quot;GET /download/path/to/file.xml&quot;</span>
  <span class="n">multiParams</span><span class="o">(</span><span class="s">&quot;splat&quot;</span><span class="o">)</span> <span class="c1">// == Seq(&quot;path/to/file&quot;, &quot;xml&quot;)</span>
<span class="o">}</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/guides/http/routes.html">/guides/http/routes.html</a></p>

<hr/>

<h4 id="toc_13">multiParams(&ldquo;captures&rdquo;)</h4>
<pre class="highlight java"><span class="n">get</span><span class="o">(</span><span class="s">&quot;&quot;&quot;^\/f(.*)/b(.*)&quot;&quot;&quot;</span><span class="o">.</span><span class="na">r</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches &quot;GET /foo/bar&quot;</span>
  <span class="n">multiParams</span><span class="o">(</span><span class="s">&quot;captures&quot;</span><span class="o">)</span> <span class="c1">// == Seq(&quot;oo&quot;, &quot;ar&quot;)</span>
<span class="o">}</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/guides/http/routes.html">/guides/http/routes.html</a></p>

<hr/>

<h4 id="toc_14">Cookies</h4>

<hr/>
<pre class="highlight java"><span class="n">def</span> <span class="n">hello</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">cookies</span> <span class="o">+=</span> <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;value&quot;</span>
  <span class="n">cookies</span> <span class="o">-=</span> <span class="s">&quot;name&quot;</span>
<span class="o">}</span>

<span class="n">def</span> <span class="n">helloWithOptions</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">implicit</span> <span class="n">val</span> <span class="n">options</span> <span class="o">=</span> <span class="n">CookieOptions</span><span class="o">(</span><span class="n">secure</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="n">cookies</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;value&quot;</span><span class="o">)</span>
  <span class="n">cookies</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;value&quot;</span><span class="o">)(</span><span class="n">options</span><span class="o">)</span>
<span class="o">}</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.SweetCookies">/api/index.html#org.scalatra.SweetCookies</a></p>

<p><a href="http://www.scalatra.org/2.2/api/org/scalatra/CookieOptions.html">/api/org/scalatra/CookieOptions.html</a></p>

<hr/>

<h4 id="toc_15">Request/Response Headers</h4>

<hr/>
<pre class="highlight java"><span class="n">val</span> <span class="nl">v:</span> <span class="n">Option</span><span class="o">[</span><span class="n">String</span><span class="o">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichRequest">/api/index.html#org.scalatra.servlet.RichRequest</a></p>
<pre class="highlight java"><span class="n">response</span><span class="o">.</span><span class="na">headers</span> <span class="o">+=</span> <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;value&quot;</span>
<span class="n">response</span><span class="o">.</span><span class="na">headers</span> <span class="o">-=</span> <span class="s">&quot;name&quot;</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichResponse">/api/index.html#org.scalatra.servlet.RichResponse</a></p>

<hr/>

<h4 id="toc_16">Session</h4>

<hr/>
<pre class="highlight java"><span class="n">val</span> <span class="nl">v:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">session</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="c1">// or session(&#39;name)</span>
<span class="n">session</span> <span class="o">+=</span> <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;value&quot;</span>
<span class="n">session</span> <span class="o">-=</span> <span class="s">&quot;name&quot;</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.RichSession">/api/index.html#org.scalatra.RichSession</a></p>

<p>Even if you don&rsquo;t use session by yourself, Scalatra&rsquo;s Flash and CSRF protection features are using servlet sessions.
So your apps are not naturally stateless.</p>

<p>We recommend you using SkinnySesison to keep your Skinny apps stateless.
When you enable SkinnySession, these features also start using SkinnySession instead of Servlet session attributes.</p>

<p>ScalatraBootstrap.scala:</p>
<pre class="highlight java"><span class="kn">import</span> <span class="nn">scalikejdbc._</span>
<span class="kn">import</span> <span class="nn">skinny.session.SkinnySessionInitializer</span>
<span class="kd">class</span> <span class="nc">ScalatraBootstrap</span> <span class="kd">extends</span> <span class="n">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="n">override</span> <span class="n">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="nl">ctx:</span> <span class="n">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Database queries will be increased</span>
    <span class="n">GlobalSettings</span><span class="o">.</span><span class="na">loggingSQLAndTime</span> <span class="o">=</span> <span class="n">LoggingSQLAndTimeSettings</span><span class="o">(</span>
      <span class="n">singleLineMode</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">mount</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="n">SkinnySessionInitializer</span><span class="o">],</span> <span class="s">&quot;/*&quot;</span><span class="o">)</span>

    <span class="n">Controllers</span><span class="o">.</span><span class="na">root</span><span class="o">.</span><span class="na">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
    <span class="n">AssetsController</span><span class="o">.</span><span class="na">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>controller/RootController.scala:</p>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">RootController</span> <span class="kd">extends</span> <span class="n">ApplicationController</span> <span class="n">with</span> <span class="n">SkinnySessionFilter</span> <span class="o">{</span>

  <span class="n">def</span> <span class="n">index</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">val</span> <span class="nl">v:</span> <span class="n">Option</span><span class="o">[</span><span class="n">Any</span><span class="o">]</span> <span class="o">=</span> <span class="n">skinnySession</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="n">skinnySession</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;value&quot;</span><span class="o">)</span>
    <span class="n">skinnySession</span><span class="o">.</span><span class="na">deleteAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>DB migration file:</p>
<pre class="highlight sql"><span class="c1">-- H2 Database compatible
</span><span class="k">create</span> <span class="k">table</span> <span class="n">skinny_sessions</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigserial</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">created_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">expire_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">servlet_sessions</span> <span class="p">(</span>
  <span class="n">jsession_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">skinny_session_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">created_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">skinny_sessions</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">skinny_session_attributes</span> <span class="p">(</span>
  <span class="n">skinny_session_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">attribute_name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">attribute_value</span> <span class="n">varbinary</span><span class="p">(</span><span class="mi">10485760</span><span class="p">),</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">skinny_sessions</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">skinny_session_attributes</span> <span class="k">add</span> <span class="k">constraint</span>
  <span class="n">skinny_session_attributes_unique_idx</span>
  <span class="k">unique</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">);</span>
</pre>
<hr/>

<h4 id="toc_17">Flash</h4>

<hr/>

<p>Notice: Flash uses servlet sessions by default. Be aware of sticky session mode.</p>
<pre class="highlight java"><span class="n">flash</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">=</span> <span class="n">value</span>
<span class="n">flash</span> <span class="o">+=</span> <span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">)</span>
<span class="n">flash</span><span class="o">.</span><span class="na">now</span> <span class="o">+=</span> <span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">)</span>
</pre>
<p><a href="http://www.scalatra.org/guides/http/flash.html">/guides/http/flash.html</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.FlashMap">/api/index.html#org.scalatra.FlashMap</a></p>

<hr/>

<h4 id="toc_18">Request Body</h4>

<hr/>
<pre class="highlight java"><span class="n">val</span> <span class="nl">body:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">body</span>
<span class="n">val</span> <span class="nl">stream:</span> <span class="n">InputStream</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">inputStream</span> <span class="c1">// raw HTTP POST data</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichRequest">/api/index.html#org.scalatra.servlet.RichRequest</a></p>

<hr/>

<h4 id="toc_19">File Upload</h4>

<hr/>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">FilesController</span> <span class="kd">extends</span> <span class="n">SkinnyController</span> <span class="n">with</span> <span class="n">FileUploadSupport</span> <span class="o">{</span>

  <span class="n">def</span> <span class="n">upload</span> <span class="o">=</span> <span class="n">fileParams</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;file&quot;</span><span class="o">)</span> <span class="n">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">Some</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">=&gt;</span>
      <span class="n">Ok</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">Map</span><span class="o">(</span>
        <span class="s">&quot;Content-Type&quot;</span>        <span class="o">-&gt;</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">contentType</span><span class="o">.</span><span class="na">getOrElse</span><span class="o">(</span><span class="s">&quot;application/octet-stream&quot;</span><span class="o">)),</span>
        <span class="s">&quot;Content-Disposition&quot;</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="s">&quot;attachment; filename=\&quot;&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">name</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="o">)</span>
      <span class="o">))</span>
    <span class="k">case</span> <span class="n">None</span> <span class="o">=&gt;</span>
      <span class="n">BadRequest</span><span class="o">(</span><span class="n">displayPage</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
          <span class="n">Hey</span><span class="o">!</span> <span class="n">You</span> <span class="n">forgot</span> <span class="n">to</span> <span class="n">select</span> <span class="n">a</span> <span class="n">file</span><span class="o">.</span>
        <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;))</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p><a href="http://www.scalatra.org/guides/formats/upload.html">/guides/formats/upload.html</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.fileupload.FileUploadSupport">/api/index.html#org.scalatra.fileupload.FileUploadSupport</a></p>

<hr/>

<h4 id="toc_20">Response handling</h4>

<hr/>
<pre class="highlight java"><span class="n">halt</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>
<span class="n">halt</span><span class="o">(</span><span class="n">status</span> <span class="o">=</span> <span class="mi">400</span><span class="o">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">Map</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">),</span> <span class="n">reason</span> <span class="o">=</span> <span class="s">&quot;why&quot;</span><span class="o">)</span>

<span class="n">redirect</span><span class="o">(</span><span class="s">&quot;/top&quot;</span><span class="o">)</span> <span class="c1">// 302</span>
<span class="n">redirect301</span><span class="o">(</span><span class="s">&quot;/new_url&quot;</span><span class="o">)</span> <span class="c1">// 301</span>
<span class="n">redirect302</span><span class="o">(</span><span class="s">&quot;/somewhere&quot;</span><span class="o">)</span> <span class="c1">// 302</span>
<span class="n">redirect303</span><span class="o">(</span><span class="s">&quot;/complete&quot;</span><span class="o">)</span> <span class="c1">// 303</span>
</pre>
<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ActionResult">/index.html#org.scalatra.ActionResult</a></p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/develop/framework/src/main/scala/skinny/controller/feature/ExplicitRedirectFeature.scala">/framework/src/main/scala/skinny/controller/feature/ExplicitRedirectFeature.scala</a></p>

<p><a href="https://github.com/scalatra/scalatra/blob/2.2.x_2.10/core/src/main/scala/org/scalatra/ActionResult.scala">/core/src/main/scala/org/scalatra/ActionResult.scala</a></p>

<hr/>

<h4 id="toc_21">CSRF Protection</h4>

<hr/>

<p>Notice: Scalatra CSRF protection implementation uses servlet sessions by default. Be aware of sticky session mode.</p>

<p>Define <code>protectFromForgery</code> in controller/RootController.scala:</p>
<pre class="highlight java"><span class="kd">class</span> <span class="nc">RootController</span> <span class="kd">extends</span> <span class="n">ApplicationController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span>

<span class="o">}</span>
</pre>
<p>Use <code>Skinny.csrfMetaTags</code> in /WEB-INF/layouts/default.jade:</p>
<pre class="highlight text">-@val body: String
-@val s: skinny.Skinny
!!! 5
%html(lang=&quot;en&quot;)
  %head
    %meta(charset=&quot;utf-8&quot;)
    != s.csrfMetaTags
  %body
    =unescape(body)
    %script(type=&quot;text/javascript&quot; src={uri(&quot;/assets/js/skinny.js&quot;)})
</pre>
            <hr/>
            <div class="alert alert-info small"> 
              If this webpage has typo or something wrong, Please report or fix. <a href="/contribution.html">How?</a>
            </div> 
<a href="https://twitter.com/SkinnyFramework" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @SkinnyFramework</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>

